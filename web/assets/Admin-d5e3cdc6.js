import{a as w,_ as T,r as c,o as j,b as r,c as b,d as x,e as t,w as a,f as _,F as B,g as q,E as s,h as E,i as u}from"./index-af451432.js";const V={getUsers(){return w.get("/api/users")},addUser(i){return w.post("/api/users/add",i)},deleteUser(i){return w.post("/api/users/delete",{id:i})}};const G={class:"admin-layout"},H={class:"admin-content"},J={__name:"Admin",setup(i){const p=c("user"),I=async l=>{if(l)try{const e=await V.deleteUser(l);e&&e.code===0?(s.success("删除成功"),v()):s.error(e.desc||"删除失败")}catch{s.error("删除用户失败")}},o=c({name:"",password:"",role:"user"}),C=c([]),f=c([]),v=async()=>{try{const l=await V.getUsers();l&&Array.isArray(l)&&(C.value=l)}catch{s.error("获取用户列表失败")}},M=async()=>{if(!o.value.name||!o.value.password||!o.value.role){s.error("请填写完整信息");return}try{const l=await V.addUser(o.value);l&&l.code===0?(s.success("添加成功"),o.value={name:"",password:"",role:"user"},v()):s.error(l.desc||"添加失败")}catch{s.error("添加用户失败")}},U=async()=>{try{const l=await E.getContests();Array.isArray(l)?f.value=l:l&&Array.isArray(l.data)&&(f.value=l.data)}catch{s.error("获取项目列表失败")}},h=async l=>{if(l)try{const e=await E.deleteContest(l);e&&e.code===0?(s.success("项目已删除"),U()):s.error(e.desc||"删除失败")}catch{s.error("删除项目失败")}};return j(()=>{v(),U()}),(l,e)=>{const A=r("el-menu-item"),z=r("el-menu"),g=r("el-input"),m=r("el-form-item"),k=r("el-option"),D=r("el-select"),y=r("el-button"),F=r("el-form"),$=r("el-divider"),d=r("el-table-column"),N=r("el-table");return b(),x("div",G,[t(z,{class:"admin-menu","default-active":p.value,onSelect:e[0]||(e[0]=n=>p.value=n),style:{width:"200px","min-width":"200px"}},{default:a(()=>[t(A,{index:"user"},{default:a(()=>[...e[4]||(e[4]=[u("用户管理",-1)])]),_:1}),t(A,{index:"contest"},{default:a(()=>[...e[5]||(e[5]=[u("评测项目管理",-1)])]),_:1})]),_:1},8,["default-active"]),_("div",H,[p.value==="user"?(b(),x(B,{key:0},[e[8]||(e[8]=_("h2",null,"新增用户",-1)),t(F,{model:o.value,"label-width":"80px",style:{"max-width":"400px"}},{default:a(()=>[t(m,{label:"用户名"},{default:a(()=>[t(g,{modelValue:o.value.name,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.name=n),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),t(m,{label:"密码"},{default:a(()=>[t(g,{modelValue:o.value.password,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.password=n),type:"password",placeholder:"密码"},null,8,["modelValue"])]),_:1}),t(m,{label:"角色"},{default:a(()=>[t(D,{modelValue:o.value.role,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.role=n),placeholder:"请选择角色"},{default:a(()=>[t(k,{label:"普通用户",value:"user"}),t(k,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[t(y,{type:"primary",onClick:M},{default:a(()=>[...e[6]||(e[6]=[u("添加用户",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),t($),e[9]||(e[9]=_("h3",null,"用户列表",-1)),t(N,{data:C.value,style:{width:"100%"}},{default:a(()=>[t(d,{prop:"id",label:"ID",width:"120"}),t(d,{prop:"name",label:"用户名"}),t(d,{prop:"role",label:"角色"}),t(d,{label:"操作",width:"100"},{default:a(n=>[t(y,{type:"danger",size:"small",onClick:S=>I(n.row.id)},{default:a(()=>[...e[7]||(e[7]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])],64)):p.value==="contest"?(b(),x(B,{key:1},[e[11]||(e[11]=_("h2",null,"评测项目管理",-1)),t(N,{data:f.value,style:{width:"100%"}},{default:a(()=>[t(d,{prop:"id",label:"项目ID",width:"180"}),t(d,{prop:"title",label:"标题"}),t(d,{prop:"owner_name",label:"主办方"}),t(d,{prop:"created_at",label:"创建时间"}),t(d,{label:"操作",width:"100"},{default:a(n=>[t(y,{type:"danger",size:"small",onClick:S=>h(n.row.id)},{default:a(()=>[...e[10]||(e[10]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])],64)):q("",!0)])])}}},L=T(J,[["__scopeId","data-v-f39f7381"]]);export{L as default};
