# ç®—æ³•è¯„æµ‹ç³»ç»Ÿ (Contest Evaluation System)

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ç®—æ³•ç¼–ç¨‹è¯„æµ‹å¹³å°ï¼Œé›†æˆäº†å‚èµ›è€…ä»£ç æäº¤ã€è‡ªåŠ¨åŒ–è¯„æµ‹ã€ç»“æœç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œåç«¯åŸºäº Flaskï¼Œå‰ç«¯åŸºäº Vue 3ã€‚

![Python](https://img.shields.io/badge/Python-3.8+-blue?logo=python&logoColor=white)
![Flask](https://img.shields.io/badge/Flask-3.0.0-green?logo=flask)
![Docker](https://img.shields.io/badge/Docker-7.0.0-blue?logo=docker)
![Vue.js](https://img.shields.io/badge/Vue.js-3.3+-brightgreen?logo=vue.js)
![License](https://img.shields.io/badge/License-MIT-yellow)

---

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„**åœ¨çº¿ç®—æ³•ç¼–ç¨‹è¯„æµ‹å¹³å°**ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¯è‡ªåŠ¨åˆ¤æ–­ç”¨æˆ·æäº¤ä»£ç çš„æ­£ç¡®æ€§ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ” **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**ï¼šåŸºäºç”¨æˆ·åå¯†ç çš„ç™»å½•è®¤è¯
- ğŸ“ **ç®—æ³•ç®¡ç†**ï¼šåˆ›å»ºã€ç¼–è¾‘ã€æŸ¥çœ‹ç®—æ³•ä¿¡æ¯
- ğŸ“¤ **ä»£ç æäº¤**ï¼šæ”¯æŒå•ä¸ªæ–‡ä»¶æˆ– ZIP åŒ…ä¸Šä¼ 
- ğŸ³ **Docker éš”ç¦»æ‰§è¡Œ**ï¼šå®‰å…¨çš„å®¹å™¨åŒ–ä»£ç è¿è¡Œç¯å¢ƒ
- â±ï¸ **è‡ªåŠ¨åŒ–è¯„æµ‹**ï¼šåŸºäºæµ‹è¯•æ•°æ®çš„è‡ªåŠ¨ç»“æœåˆ¤æ–­
- ğŸ“Š **è¯„æµ‹é˜Ÿåˆ—**ï¼šå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†ï¼Œæ”¯æŒå¹¶å‘è¯„æµ‹
- ğŸ”§ **èµ„æºç®¡ç†**ï¼šè‡ªåŠ¨æ¸…ç†å­¤ç«‹ Docker é•œåƒå’Œå®¹å™¨
- ğŸ’š **å¥åº·æ£€æŸ¥**ï¼šå®æ—¶ç³»ç»ŸçŠ¶æ€ç›‘æ§ç«¯ç‚¹
- ğŸ“‹ **å®Œæ•´æ—¥å¿—**ï¼šè¯¦ç»†çš„æ“ä½œå’Œé”™è¯¯æ—¥å¿—è®°å½•

---

## ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½

### 1. ç”¨æˆ·ç®¡ç†

- ç”¨æˆ·ç™»å½•/ç™»å‡º
- ç”¨æˆ·æƒé™æ§åˆ¶ï¼ˆå‚èµ›è€… vs ä¸»åŠæ–¹ï¼‰
- Session ä¼šè¯ç®¡ç†

### 2. ç®—æ³•ç®¡ç†

- åˆ›å»ºæ–°ç®—æ³•ï¼ˆç”Ÿæˆå”¯ä¸€ IDï¼‰
- ä¸Šä¼ ç®—æ³•ä¿¡æ¯ï¼ˆJSON æ ¼å¼ï¼‰
- æŸ¥çœ‹æ‰€æœ‰ç®—æ³•åˆ—è¡¨
- ç®—æ³•è¯¦æƒ…æŸ¥è¯¢

### 3. ä»£ç è¯„æµ‹

- å‚èµ›è€…æäº¤ä»£ç å’Œæµ‹è¯•ç”¨ä¾‹
- Docker å®¹å™¨éš”ç¦»æ‰§è¡Œ
- åˆ†åˆ«æ”¯æŒå‚èµ›è€…å’Œä¸»åŠæ–¹çš„é…ç½®
  - **å‚èµ›è€…**ï¼š300 ç§’è¶…æ—¶ï¼Œ2 æ ¸ CPUï¼Œ2GB å†…å­˜
  - **ä¸»åŠæ–¹**ï¼š300 ç§’è¶…æ—¶ï¼Œ1 æ ¸ CPUï¼Œ1GB å†…å­˜
- è¯¦ç»†çš„è¯„æµ‹ç»“æœï¼šé€šè¿‡/å¤±è´¥/è¶…æ—¶/é”™è¯¯
- æ‰§è¡Œæ—¥å¿—ä¿å­˜

### 4. å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—

- åŸºäºæ–‡ä»¶çš„æŒä¹…åŒ–é˜Ÿåˆ—
- FIFO å¤„ç†é¡ºåº
- å®æ—¶é˜Ÿåˆ—çŠ¶æ€ç›‘æ§
- æ”¯æŒå¤šä¸ªå¹¶å‘è¯„æµ‹

### 5. ç³»ç»Ÿç›‘æ§

- å¥åº·æ£€æŸ¥ç«¯ç‚¹ (`/health`)
- Docker èµ„æºç»Ÿè®¡
- å®šæœŸæ¸…ç†å­¤ç«‹èµ„æº
- å®Œæ•´çš„æ“ä½œæ—¥å¿—

---

## ğŸ›  æŠ€æœ¯æ ˆ

### åç«¯

| æŠ€æœ¯              | ç‰ˆæœ¬  | ç”¨é€”         |
| ----------------- | ----- | ------------ |
| **Python**        | 3.8+  | æ ¸å¿ƒç¼–ç¨‹è¯­è¨€ |
| **Flask**         | 3.0.0 | Web æ¡†æ¶     |
| **Flask-CORS**    | 4.0.0 | è·¨åŸŸèµ„æºå…±äº« |
| **Docker SDK**    | 7.0.0 | å®¹å™¨ç®¡ç†     |
| **python-dotenv** | 1.0.0 | ç¯å¢ƒå˜é‡ç®¡ç† |
| **Werkzeug**      | 3.0.1 | WSGI å·¥å…·åº“  |

### å‰ç«¯

| æŠ€æœ¯             | ç‰ˆæœ¬  | ç”¨é€”        |
| ---------------- | ----- | ----------- |
| **Vue.js**       | 3.3+  | å‰ç«¯æ¡†æ¶    |
| **Vue Router**   | 4.6.3 | è·¯ç”±ç®¡ç†    |
| **Element Plus** | 2.4.4 | UI ç»„ä»¶åº“   |
| **Axios**        | 1.6.5 | HTTP å®¢æˆ·ç«¯ |
| **Vite**         | 4.5.0 | æ„å»ºå·¥å…·    |

### åŸºç¡€è®¾æ–½

- **Docker** - å®¹å™¨åŒ–æ‰§è¡Œ
- **Git** - ç‰ˆæœ¬æ§åˆ¶

---

## ğŸ— ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Web æµè§ˆå™¨                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ Frontend â”‚               â”‚  REST API  â”‚
    â”‚(Vue 3)   â”‚               â”‚ (Flask)    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Core Services         â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚ â”‚ Contest Service  â”‚    â”‚
        â”‚ â”‚ Submission Svc   â”‚    â”‚
        â”‚ â”‚ User Manager     â”‚    â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Task Queue System   â”‚
        â”‚ (task_queue.json)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Queue Runner       â”‚
      â”‚ (Async Worker)      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Docker Worker           â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ â”‚ Image Management   â”‚   â”‚
    â”‚ â”‚ Container Exec     â”‚   â”‚
    â”‚ â”‚ Result Collection  â”‚   â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Docker Engine  â”‚
         â”‚  & Containers  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
ç”¨æˆ·æäº¤
  â†“
éªŒè¯ & ä¸Šä¼ 
  â†“
åˆ›å»ºè¯„æµ‹ä»»åŠ¡ â†’ å…¥é˜Ÿ
  â†“
é˜Ÿåˆ—è¿è¡Œå™¨æ£€å–ä»»åŠ¡
  â†“
Docker Worker æ‰§è¡Œ
  â”œâ”€ åŠ è½½é•œåƒ
  â”œâ”€ åˆ›å»ºå®¹å™¨
  â”œâ”€ æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ
  â”œâ”€ æ‰§è¡Œä»£ç 
  â””â”€ æ”¶é›†ç»“æœ
  â†“
ä¿å­˜è¯„æµ‹ç»“æœ
  â†“
è¿”å›ç”¨æˆ·
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
contest-eval-system/
â”‚
â”œâ”€â”€ ğŸ“„ app.py                    # Flask åº”ç”¨ä¸»å…¥å£
â”œâ”€â”€ ğŸ“„ config.py                 # é…ç½®ç®¡ç†ï¼ˆè¯»å– .envï¼‰
â”œâ”€â”€ ğŸ“„ utils.py                  # é€šç”¨å·¥å…·å‡½æ•°
â”œâ”€â”€ ğŸ“„ worker.py                 # Docker æ‰§è¡Œå¼•æ“
â”œâ”€â”€ ğŸ“„ task_queue.py             # ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
â”œâ”€â”€ ğŸ“„ queue_runner.py           # é˜Ÿåˆ—å¼‚æ­¥å¤„ç†å™¨
â”œâ”€â”€ ğŸ“„ logger.py                 # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ ğŸ“„ docker_utils.py           # Docker èµ„æºæ¸…ç†å·¥å…·
â”‚
â”œâ”€â”€ ğŸ“ services/                 # ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ contests.py              # ç®—æ³•ç®¡ç†æœåŠ¡
â”‚   â””â”€â”€ submissions.py           # æäº¤è®°å½•æœåŠ¡
â”‚
â”œâ”€â”€ ğŸ“ frontend/                 # å‰ç«¯ Vue åº”ç”¨
â”‚   â”œâ”€â”€ index.html               # HTML å…¥å£
â”‚   â”œâ”€â”€ package.json             # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ vite.config.js           # Vite æ„å»ºé…ç½®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.js              # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ App.vue              # æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â”‚   â””â”€â”€ index.js         # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ views/               # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.vue         # é¦–é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.vue        # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ ContestList.vue  # ç®—æ³•åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ CreateContest.vue# åˆ›å»ºç®—æ³•
â”‚   â”‚   â”‚   â””â”€â”€ SubmitTask.vue   # æäº¤ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ components/          # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/              # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ api/                 # API è¯·æ±‚å±‚
â”‚   â”‚       â”œâ”€â”€ request.js       # HTTP è¯·æ±‚é…ç½®
â”‚   â”‚       â”œâ”€â”€ auth.js          # è®¤è¯ API
â”‚   â”‚       â””â”€â”€ contest.js       # ç®—æ³• API
â”‚   â””â”€â”€ dist/                    # ç¼–è¯‘è¾“å‡ºç›®å½•
â”‚
â”œâ”€â”€ ğŸ“ projects/                 # ç®—æ³•æ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ {contest_id}/
â”‚       â”œâ”€â”€ info/
â”‚       â”‚   â””â”€â”€ info.json        # ç®—æ³•ä¿¡æ¯
â”‚       â”œâ”€â”€ dataset/
â”‚       â”‚   â”œâ”€â”€ source/          # è¯„æµ‹æ•°æ®æº
â”‚       â”‚   â””â”€â”€ result/          # ç»“æœé›†
â”‚       â””â”€â”€ evaluation/
â”‚           â”œâ”€â”€ submissions.json # æäº¤è®°å½•
â”‚           â””â”€â”€ submissions/     # æäº¤å†…å®¹å­˜å‚¨
â”‚
â”œâ”€â”€ ğŸ“ uploads/                  # ä¸´æ—¶ä¸Šä¼ æ–‡ä»¶
â”‚
|â”€â”€ ğŸ“ web/                      # æœåŠ¡ç«¯é™æ€èµ„æºç›®å½•ï¼Œå­˜æ”¾å‰ç«¯åº”ç”¨æ‰“åŒ…åçš„äº§ç‰©
|
â”œâ”€â”€ ğŸ“ logs/                     # æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ app.log                  # åº”ç”¨æ—¥å¿—ï¼ˆè‡ªåŠ¨è½®è½¬ï¼‰
â”‚
â”œâ”€â”€ ğŸ“„ requirements.txt          # Python ä¾èµ–
â”œâ”€â”€ ğŸ“„ users.json                # ç”¨æˆ·é…ç½®
â”œâ”€â”€ ğŸ“„ task_queue.json           # ä»»åŠ¡é˜Ÿåˆ—ï¼ˆè¿è¡Œæ—¶ï¼‰
â”œâ”€â”€ ğŸ“„ .env                      # ç¯å¢ƒé…ç½®
â”œâ”€â”€ ğŸ“„ .gitignore                # Git å¿½ç•¥è§„åˆ™
â””â”€â”€ ğŸ“„ README.md                 # é¡¹ç›®æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

- **Python** 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Docker** æœåŠ¡è¿è¡Œä¸­
- **Node.js** 14+ å’Œ npmï¼ˆç”¨äºå‰ç«¯å¼€å‘ï¼‰

### åç«¯éƒ¨ç½²

#### 1. å…‹éš†é¡¹ç›®å¹¶è¿›å…¥ç›®å½•

```bash
git clone <repository-url>
cd contest-eval-system
```

#### 2. åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# macOS/Linux
python3 -m venv venv
source venv/bin/activate
```

#### 3. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

#### 4. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶å¹¶ä¿®æ”¹ `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` å¡«å†™é…ç½®ï¼š

```env
# Flask é…ç½®
FLASK_ENV=development
FLASK_SECRET_KEY=your-secret-key-here

# æ–‡ä»¶ä¸Šä¼ é…ç½®
BASE_DIR=./projects
UPLOAD_FOLDER=./uploads
ZIP_MAX_SIZE=524288000

# å‚èµ›è€…è¯„æµ‹é…ç½®
PARTICIPANT_TIMEOUT=300
PARTICIPANT_CPU_CORES=2
PARTICIPANT_MEM_LIMIT=2g

# ä¸»åŠæ–¹è¯„æµ‹é…ç½®
ORGANIZER_TIMEOUT=300
ORGANIZER_CPU_CORES=1
ORGANIZER_MEM_LIMIT=1g
```

#### 5. åˆå§‹åŒ–ç”¨æˆ·æ•°æ®

ç¼–è¾‘ `users.json`ï¼š

```json
[
  {
    "id": "user1",
    "name": "å‚èµ›è€…1",
    "password": "pass123",
    "role": "participant"
  }
]
```

âš ï¸ **å®‰å…¨æç¤º**ï¼šç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨å¯†ç åŠ å¯†å’Œæ›´å¼ºçš„å¯†é’¥ç®¡ç†ã€‚

#### 6. å¯åŠ¨åç«¯æœåŠ¡

```bash
python app.py
```

æœåŠ¡å°†åœ¨ `http://localhost:5000` å¯åŠ¨ã€‚

### å‰ç«¯éƒ¨ç½²

#### 1. è¿›å…¥å‰ç«¯ç›®å½•

```bash
cd frontend
```

#### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

#### 3. å¼€å‘æ¨¡å¼è¿è¡Œ

```bash
npm run dev
```

å‰ç«¯å¼€å‘æœåŠ¡å°†åœ¨ `http://localhost:5173` å¯åŠ¨ã€‚

#### 4. ç”Ÿäº§æ„å»º

```bash
npm run build
```

ç¼–è¯‘åçš„æ–‡ä»¶åœ¨ `dist/` ç›®å½•ä¸­ï¼Œå¤åˆ¶åˆ° web ç›®å½•ä¸‹
å¯åŠ¨ python åï¼Œè®¿é—® `http://localhost:5000`

éªŒè¯é¡¹ç›®ï¼š

- âœ… æ—¥å¿—ç³»ç»Ÿ
- âœ… Docker ç»Ÿè®¡
- âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹
- âœ… èµ„æºæ¸…ç†åŠŸèƒ½

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ (.env)

| å˜é‡å                  | é»˜è®¤å€¼              | è¯´æ˜                               |
| ----------------------- | ------------------- | ---------------------------------- |
| `FLASK_ENV`             | `development`       | è¿è¡Œç¯å¢ƒï¼ˆdevelopment/productionï¼‰ |
| `FLASK_SECRET_KEY`      | `change-me-locally` | Flask session å¯†é’¥                 |
| `BASE_DIR`              | `./projects`        | ç®—æ³•æ•°æ®å­˜å‚¨ç›®å½•                   |
| `UPLOAD_FOLDER`         | `./uploads`         | æ–‡ä»¶ä¸Šä¼ ä¸´æ—¶ç›®å½•                   |
| `ZIP_MAX_SIZE`          | `524288000`         | ZIP æœ€å¤§å¤§å°ï¼ˆå­—èŠ‚ï¼Œé»˜è®¤ 500MBï¼‰   |
| `PARTICIPANT_TIMEOUT`   | `300`               | å‚èµ›è€…ä»£ç æ‰§è¡Œè¶…æ—¶ï¼ˆç§’ï¼‰           |
| `PARTICIPANT_CPU_CORES` | `2`                 | å‚èµ›è€…å®¹å™¨ CPU æ ¸å¿ƒæ•°              |
| `PARTICIPANT_MEM_LIMIT` | `2g`                | å‚èµ›è€…å®¹å™¨å†…å­˜é™åˆ¶                 |
| `ORGANIZER_TIMEOUT`     | `300`               | ä¸»åŠæ–¹ä»£ç æ‰§è¡Œè¶…æ—¶ï¼ˆç§’ï¼‰           |
| `ORGANIZER_CPU_CORES`   | `1`                 | ä¸»åŠæ–¹å®¹å™¨ CPU æ ¸å¿ƒæ•°              |
| `ORGANIZER_MEM_LIMIT`   | `1g`                | ä¸»åŠæ–¹å®¹å™¨å†…å­˜é™åˆ¶                 |

### ç®—æ³•ä¿¡æ¯æ ¼å¼ (info.json)

```json
{
  "title": "ç®—æ³•åç§°",
  "description": "ç®—æ³•æè¿°",
  "owner_id": "user_id",
  "owner_name": "ç”¨æˆ·å",
  "created_at": "2024-01-01T00:00:00",
  "start_time": "2024-01-01T09:00:00",
  "end_time": "2024-01-01T17:00:00",
  "problem_count": 3,
  "participant_count": 50
}
```

---

## ğŸ“¡ API æ–‡æ¡£

### è®¤è¯ç›¸å…³

#### ç™»å½•

```
POST /api/login
Content-Type: application/json

{
  "username": "user_id_or_name",
  "password": "password"
}

Response:
{
  "code": 0,
  "desc": "ç™»å½•æˆåŠŸ",
  "user": {
    "id": "user1",
    "name": "å‚èµ›è€…1"
  }
}
```

#### ç™»å‡º

```
GET /api/logout

Response:
{
  "code": 0,
  "desc": "ç™»å‡ºæˆåŠŸ"
}
```

### ç®—æ³•ç®¡ç†

#### åˆ›å»ºç®—æ³•

```
POST /api/contests/create
Content-Type: multipart/form-data

Files:
- file: (info.json å†…å®¹çš„ ZIP åŒ…)

Response:
{
  "code": 0,
  "contest_id": "CMP20240101090000-000",
  "message": "ç®—æ³•åˆ›å»ºæˆåŠŸ"
}
```

#### è·å–ç®—æ³•åˆ—è¡¨

```
GET /api/contests/list

Response:
{
  "code": 0,
  "contests": [
    {
      "id": "CMP20240101090000-000",
      "title": "ç®—æ³•1",
      "owner_name": "ç®¡ç†å‘˜",
      "created_at": "2024-01-01T09:00:00"
    }
  ]
}
```

#### è·å–ç®—æ³•è¯¦æƒ…

```
GET /api/contests/<contest_id>/info

Response:
{
  "code": 0,
  "info": { ... }
}
```

### è¯„æµ‹ç›¸å…³

#### æäº¤ä»£ç 

```
POST /api/submit/<contest_id>
Content-Type: multipart/form-data

Files:
- submission: (æäº¤çš„ TAR æˆ– ZIP æ–‡ä»¶)
- dataset: (å¯é€‰ï¼Œæµ‹è¯•æ•°æ®)

Parameters:
- participant_id: å‚èµ›è€… ID
- submission_id: æäº¤ç¼–å·

Response:
{
  "code": 0,
  "queue_position": 1,
  "message": "æäº¤æˆåŠŸï¼Œå·²åŠ å…¥è¯„æµ‹é˜Ÿåˆ—"
}
```

#### è·å–è¯„æµ‹ç»“æœ

```
GET /api/submissions/<contest_id>?participant_id=xxx

Response:
{
  "code": 0,
  "submissions": [
    {
      "submission_id": "001",
      "participant_id": "user1",
      "status": "SUCCESS",
      "score": 100,
      "execution_time": 0.523,
      "submitted_at": "2024-01-01T09:15:00"
    }
  ]
}
```

### ç³»ç»Ÿç›‘æ§

#### å¥åº·æ£€æŸ¥

```
GET /health

Response:
{
  "status": "healthy",
  "timestamp": "2024-01-01T09:30:00.000000",
  "queue_size": 2,
  "docker": "ok",
  "docker_details": {
    "images": 15,
    "containers": 3,
    "running": 1,
    "dangling_images": 2
  }
}
```

---

## ğŸ”„ å·¥ä½œæµç¨‹

### è¯„æµ‹æµç¨‹è¯¦è§£

```
1. ç”¨æˆ·æäº¤
   â””â”€> app.py /api/submit
       â”œâ”€ éªŒè¯ç”¨æˆ·æƒé™
       â”œâ”€ æ£€æŸ¥æ–‡ä»¶ç±»å‹å’Œå¤§å°
       â”œâ”€ ä¿å­˜ä¸Šä¼ æ–‡ä»¶
       â””â”€ åˆ›å»ºè¯„æµ‹ä»»åŠ¡ â†’ å…¥é˜Ÿ

2. ä»»åŠ¡å…¥é˜Ÿ
   â””â”€> task_queue.py enqueue_task()
       â”œâ”€ ç”Ÿæˆä»»åŠ¡ ID
       â”œâ”€ è®°å½•æ—¶é—´æˆ³
       â””â”€ ä¿å­˜åˆ° task_queue.json

3. é˜Ÿåˆ—å¤„ç†
   â””â”€> queue_runner.py (åå°çº¿ç¨‹)
       â”œâ”€ å®šæœŸæ£€æŸ¥é˜Ÿåˆ—
       â”œâ”€ å–å‡ºå¾…è¯„æµ‹ä»»åŠ¡
       â””â”€ è°ƒç”¨ worker æ‰§è¡Œ

4. Docker æ‰§è¡Œ
   â””â”€> worker.py run_worker()
       â”œâ”€ åŠ è½½ç”¨æˆ·é•œåƒ
       â”œâ”€ æŒ‚è½½æµ‹è¯•æ•°æ®é›†
       â”œâ”€ åˆ›å»ºå®¹å™¨å¹¶æ‰§è¡Œ
       â”œâ”€ æ”¶é›†è¾“å‡ºå’Œæ—¥å¿—
       â””â”€ è¿”å›æ‰§è¡Œç»“æœ

5. ç»“æœä¿å­˜
   â””â”€> services/submissions.py
       â”œâ”€ ç”Ÿæˆè¯„æµ‹ç»“æœ JSON
       â”œâ”€ ä¿å­˜æ‰§è¡Œæ—¥å¿—
       â”œâ”€ æ›´æ–°æäº¤è®°å½•
       â””â”€ æ¸…ç†ä¸´æ—¶æ–‡ä»¶

6. å‰ç«¯å±•ç¤º
   â””â”€> ç”¨æˆ·æŸ¥è¯¢ç»“æœ
       â”œâ”€ è·å– submissions.json
       â””â”€ æ˜¾ç¤ºè¯„æµ‹è¯¦æƒ…
```

### åå°çº¿ç¨‹å·¥ä½œ

ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šåˆ›å»ºä¸¤ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼š

#### 1. é˜Ÿåˆ—å¤„ç†çº¿ç¨‹

```python
# app.py main() ä¸­å¯åŠ¨
queue_worker_thread = threading.Thread(
    target=run_queue_worker,
    daemon=True
)
```

- æŒç»­ç›‘å¬ task_queue.json
- å‘ç°æ–°ä»»åŠ¡ç«‹å³å¤„ç†
- è‡ªåŠ¨é‡è¯•å¤±è´¥ä»»åŠ¡

#### 2. Docker æ¸…ç†çº¿ç¨‹

```python
# app.py main() ä¸­å¯åŠ¨
cleanup_thread = threading.Thread(
    target=periodic_cleanup,
    kwargs={'interval_hours': 1},
    daemon=True
)
```

- æ¯å°æ—¶è¿è¡Œä¸€æ¬¡
- åˆ é™¤ 24 å°æ—¶å†…çš„å­¤ç«‹é•œåƒ
- æ¸…ç†å·²é€€å‡ºçš„å®¹å™¨

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: Docker æ— æ³•è¿æ¥

**é—®é¢˜**ï¼š`docker.errors.DockerException: Error while fetching server API version`

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ç¡®ä¿ Docker daemon è¿è¡Œ
docker ps

# Windows éœ€è¦ç¡®ä¿ Docker Desktop å¯åŠ¨
# macOS/Linux æ£€æŸ¥ Docker æœåŠ¡
sudo systemctl status docker
```

### Q2: å®¹å™¨æŒ‚è½½å¤±è´¥

**é—®é¢˜**ï¼š`docker.errors.ContainerError: 2 in run_worker`

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ç¡®ä¿ç›®å½•å­˜åœ¨ä¸”æœ‰æƒé™
mkdir -p ./projects ./uploads

# Windows ç”¨æˆ·å…±äº«é©±åŠ¨å™¨
# Docker Desktop Settings â†’ Resources â†’ File Sharing
```

### Q3: ç«¯å£å·²è¢«å ç”¨

**é—®é¢˜**ï¼š`Address already in use: ('0.0.0.0', 5000)`

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æŸ¥çœ‹å ç”¨è¿›ç¨‹
netstat -ano | findstr :5000  # Windows
lsof -i :5000                 # macOS/Linux

# æ€æ­»è¿›ç¨‹æˆ–æ”¹å˜ç«¯å£
python app.py --port 5001
```

### Q4: å‰ç«¯æ— æ³•è¿æ¥åç«¯

**é—®é¢˜**ï¼šCORS é”™è¯¯æˆ– API è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. ç¡®è®¤åç«¯å·²å¯åŠ¨ï¼š`curl http://localhost:5000/health`
2. æ£€æŸ¥å‰ç«¯é…ç½®ä¸­çš„ API åœ°å€
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

```javascript
// frontend/src/api/request.js
const API_BASE = "http://localhost:5000";
```

### Q5: ç®—æ³• ID å†²çª

**é—®é¢˜**ï¼š`RuntimeError: æ— æ³•ç”Ÿæˆå”¯ä¸€çš„è¯„æµ‹ ID`

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# services/contests.py ä¸­çš„ç”Ÿæˆé€»è¾‘
# ä»å¦ä¸€ä¸ªæ—¶é—´æˆ³é‡æ–°å¼€å§‹
# æˆ–æ‰‹åŠ¨æ¸…ç†æ—§çš„ç®—æ³•ç›®å½•
```

### Q6: æ—¥å¿—æ–‡ä»¶è¿‡å¤§

**é—®é¢˜**ï¼š`logs/app.log` æ–‡ä»¶è¿‡å¤§

**è§£å†³æ–¹æ¡ˆ**ï¼š

- ç³»ç»Ÿå·²é…ç½®è‡ªåŠ¨è½®è½¬ï¼ˆ10MB è‡ªåŠ¨å¤‡ä»½ï¼‰
- æ£€æŸ¥æ—¥å¿—çº§åˆ«æ˜¯å¦è¿‡ä½
- æ‰‹åŠ¨æ¸…ç†æ—§æ—¥å¿—ï¼š`rm logs/app.log.*`

---

## ğŸ“Š æ€§èƒ½è°ƒä¼˜

### Docker é…ç½®ä¼˜åŒ–

```env
# æ ¹æ®ç¡¬ä»¶è°ƒæ•´
PARTICIPANT_CPU_CORES=4      # æ›´å¤šæ ¸å¿ƒ
PARTICIPANT_MEM_LIMIT=4g     # æ›´å¤šå†…å­˜

ORGANIZER_TIMEOUT=600        # æ›´é•¿è¶…æ—¶
```

### é˜Ÿåˆ—æ€§èƒ½

```python
# queue_runner.py ä¸­è°ƒæ•´æ£€æŸ¥é—´éš”
time.sleep(0.5)  # åŸä¸º 1 ç§’ï¼Œæ”¹ä¸º 0.5 ç§’
```

### æ—¥å¿—ä¼˜åŒ–

```python
# logger.py ä¸­è°ƒæ•´æ—¥å¿—çº§åˆ«
logger.setLevel(logging.WARNING)  # æ”¹ä¸ºä»…è®°å½•è­¦å‘Šå’Œé”™è¯¯
```

---

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/app.log

# æŸ¥çœ‹æœ€å 100 è¡Œ
tail -100 logs/app.log

# æœç´¢é”™è¯¯
grep ERROR logs/app.log

# Windows PowerShell
Get-Content logs/app.log -Tail 100 -Wait
```

### æ—¥å¿—æ ¼å¼

```
2024-01-01 09:30:00,123 - contest-eval - INFO - app:submit_task:123 - è¯„æµ‹ä»»åŠ¡å·²å…¥é˜Ÿ
2024-01-01 09:30:05,456 - contest-eval - ERROR - worker:run_worker:456 - å®¹å™¨æ‰§è¡Œè¶…æ—¶ (exc_info=True)
```

### å¥åº·ç›‘æ§è„šæœ¬

```bash
#!/bin/bash
# æ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡æœåŠ¡å¥åº·çŠ¶æ€

while true; do
    response=$(curl -s http://localhost:5000/health)
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $response"
    sleep 5
done
```

---

## é—®é¢˜è®°å½•ï¼š

worker è¿è¡Œè„šæœ¬ï¼Œè¿è¡Œé•œåƒæ—¶å¿…é¡»æŒ‡å®š root ç”¨æˆ·è¿è¡Œ å¦åˆ™æ²¡æœ‰å†™å…¥æƒé™
å°è¯•äº†å®¿ä¸»æœºã€å®¹å™¨å†… éƒ½ç»™åˆ°äº† rwx æƒé™ ä¹Ÿä¸å¯è¡Œ å¿…é¡»é‡‡ç”¨ root ç”¨æˆ·è¿è¡Œæ‰å¯ä»¥
